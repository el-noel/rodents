<!doctype html>
<title>{% block title %}{% endblock %} - Flaskr</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap" rel="stylesheet">
<body>
    <div class="full-body-container">
        <div class="overlay-container">
            <div class="top-text">
                Rodents
                    <div class="input-box" onclick="sendFocus()">
                        <img src="{{ url_for('static', filename='images/mag.png') }}" />
                        <input name="title" placeholder="Search for a Boardgame" id="filter-text-val">
                    </div>
                    <label for="toggleSearch">Recommendation Mode:</label> <label class="switch">
                        <input type="checkbox">
                        <span class="slider"></span>
                      </label>
            </div>
            <div class="sliding-row">
                <div class="boardgame"><img src="static/images/starwars.png" alt="Boardgame 2"></div>
                <div class="boardgame"><img src="static/images/tickettoride.png" alt="Boardgame 3"></div>
                <div class="boardgame"><img src="static/images/catan.png" alt="Boardgame 3"></div>
                <div class="boardgame"><img src="static/images/avalon.png" alt="Boardgame 3"></div>
                <div class="boardgame"><img src="static/images/unstable.png" alt="Boardgame 3"></div>
                <div class="boardgame"><img src="static/images/cham.png" alt="Boardgame 3"></div>
            </div>
        </div>
    </br>
    <div class="filters">
        <input placeholder="Min Age" id="min-age" type="number" />
        <input placeholder="Min Players" id="min-players" type="number" />
        <input placeholder="Max Players" id="max-players" type="number" />
        <input placeholder="Category" id="category" type="text" />
        <button onclick="filterText()">Search</button>
    </div>
        <div id="answer-box">
        </div>
    </div>

    <script>

        function answerBoxTemplate(name, description, average,id){
            return `<div class='search-result' onclick="window.location.href='/about/${id}'">
            <h3 class='game-title'>${name}</h3>
            <p class='game-desc'>${description}</p>
            <p class='game-rating'>Average Rating: ${average.toFixed(2)}</p>
        </div>`;
        }

        function sendFocus(){
            document.getElementById('filter-text-val').focus()
        }

        function filterText() {
            const titleValue = document.getElementById("filter-text-val").value;
            const minAgeValue = document.getElementById("min-age").value || 0;
            const minPlayersValue = document.getElementById("min-players").value || 0;
            const maxPlayersValue = document.getElementById("max-players").value || Number.MAX_SAFE_INTEGER;
            const categoryValue = document.getElementById("category").value;
            const recommendationMode = document.querySelector('input[type="checkbox"]').checked ? 'recommendation' : 'regular';
        
            const queryParams = new URLSearchParams({
                title: titleValue,
                min_age: minAgeValue,
                min_players: minPlayersValue,
                max_players: maxPlayersValue,
                category: categoryValue,
                mode: recommendationMode
            }).toString();
        
            fetch(`/games?${queryParams}`)
                .then(response => response.json())
                .then(data => {
                    const answerBox = document.getElementById("answer-box");
                    answerBox.innerHTML = ""; // Clear previous results
                    data.forEach(game => {
                        let div = document.createElement("div");
                        div.innerHTML = answerBoxTemplate(game.name, game.description, game.average, game.objectid);
                        answerBox.appendChild(div);
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
        }
            
    </script>
</body>